///////////////////////////////////////////////////////////////////////////// This structure represents Factory to produce Runner/////////////////////////////////////////////////////////////////////////////struct SimpleAgroPRunnerFactory extends PRunnerFactory  //! runtextmacro Singelton("SimpleAgroPRunnerFactory")  public method createRunner takes unit u returns PRunner    return SimpleAgroPRunner.create(u)  endmethodendstructstruct SimpleAgroPRunner extends PRunner  private static boolean initialized = false  private unit u  public static ObjectiveUnitPool pool    public static method init takes ObjectiveUnitPool pool returns nothing    if (SimpleAgroPRunner.initialized == true) then      call showMessage("Map Error: attempted to initialize SimpleAgroPRunner structure twice.")      return    endif    set SimpleAgroPRunner.initialized = true      set SimpleAgroPRunner.pool = pool    call Events.registerForDeath(function SimpleAgroPRunner.catchDeath)  endmethod  public static method create takes unit u returns SimpleAgroPRunner    local SimpleAgroPRunner h    //try to allocate    set h = SimpleAgroPRunner.allocate()    if (h == nill) then      call showMessage("Critical Map Error: couldn't allocate a SimpleAgroPRunner.")      return nill    endif        set h.u = u    call RemoveGuardPosition(h.u)    call h.pool.add(h)        return h  endmethod  public method getUnit takes nothing returns unit    return this.u  endmethod    public static method fromUnit takes unit u returns SimpleAgroPRunner    return SimpleAgroPRunner(SimpleAgroPRunner.pool.get(u))  endmethod    public method runObjective takes Objective o returns nothing    local PObjective po     local location loc        // handle PObjectives here    if(o.getType()==PObjective.typeid) then      set po = PObjective(o)            //order to waypoint      set loc = po.edge.getOrderLoc(po.egdeOffset)      call IssuePointOrderLocBJ(this.u, "attack", loc)      call RemoveLocation(loc)          set loc = null    endif  endmethod    private static method catchDeath takes nothing returns nothing    local SimpleAgroPRunner r        set r = SimpleAgroPRunner.fromUnit(GetTriggerUnit())        if (r == nill) then      return    endif    //Finish    call SimpleAgroPRunner.pool.remove(r)    call r.destroy()  endmethodendstruct